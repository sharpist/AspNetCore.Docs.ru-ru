---
title: Расширенная конфигурация
author: rick-anderson
description: Расширенная настройка с помощью модуля ASP.NET Core и служб IIS.
monikerRange: '>= aspnetcore-5.0'
ms.author: riande
ms.custom: mvc
ms.date: 5/7/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: host-and-deploy/iis/advanced
ms.openlocfilehash: 9f14929a7d298d6f4d66abcc88665db34fc072bf
ms.sourcegitcommit: 3593c4efa707edeaaceffbfa544f99f41fc62535
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2021
ms.locfileid: "93058620"
---
# <a name="advanced-configuration-of-the-aspnet-core-module-and-iis"></a>Расширенная настройка модуля ASP.NET Core и служб IIS

В этой статье рассматриваются параметры и сценарии расширенной настройки модуля ASP.NET Core и служб IIS.

## <a name="modify-the-stack-size"></a>Изменение размера стека

*Применяется только при использовании модели внутрипроцессного размещения.*

Настройте размер управляемого стека, задав для параметра `stackSize` значение в байтах в файле `web.config`. Размер по умолчанию — 1 048 576 байт (1 МБ). В следующем примере размер стека изменяется на 2 МБ (2 097 152 байт).

```xml
<aspNetCore processPath="dotnet"
    arguments=".\MyApp.dll"
    stdoutLogEnabled="false"
    stdoutLogFile="\\?\%home%\LogFiles\stdout"
    hostingModel="inprocess">
  <handlerSettings>
    <handlerSetting name="stackSize" value="2097152" />
  </handlerSettings>
</aspNetCore>
```

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a>Конфигурация прокси-сервера использует протокол HTTP и токен связывания

*Применяется только к размещению вне процесса.*

Прокси-сервер, созданный между модулем ASP.NET Core и Kestrel, использует протокол HTTP. Отсутствует риск перехвата трафика между модулем и Kestrel из расположения на сервере.

Токен связывания гарантирует, что полученные Kestrel запросы были переданы службами IIS, а не из какого-либо другого источника. Этот токен создается и задается модулем в переменную среды (`ASPNETCORE_TOKEN`). Он также задается в заголовке (`MS-ASPNETCORE-TOKEN`) каждого запроса, переданного через прокси-сервер. ПО промежуточного слоя IIS проверяет каждый получаемый запрос, чтобы убедиться, что заголовок с токеном связывания соответствует значению переменной среды. Если значения токена не совпадают, запрос заносится в журнал и отклоняется. Переменная среды с токеном связывания и трафик между модулем и Kestrel недоступны из расположения на сервере. Не зная значение токена связывания, злоумышленник не может отправлять запросы, обходящие проверку в ПО промежуточного слоя IIS.

## <a name="aspnet-core-module-with-an-iis-shared-configuration"></a>Модуль ASP.NET Core с общей конфигурацией IIS

Программа установки модуля ASP.NET Core запускается с правами учетной записи `TrustedInstaller`. Поскольку учетная запись локальной системы не имеет разрешения на изменение пути к общей папке, используемого общей конфигурацией IIS, установщик получает ошибку отказа в доступе при попытке настроить параметры модуля в файле `applicationHost.config` общей папки.

При использовании общей конфигурации IIS на том же компьютере, где установлены службы IIS, запустите установщик пакета размещения ASP.NET Core с параметром `OPT_NO_SHARED_CONFIG_CHECK` со значением `1`:

```console
dotnet-hosting-{VERSION}.exe OPT_NO_SHARED_CONFIG_CHECK=1
```

Если путь к общей конфигурации не на том же компьютере, где установлены службы IIS, выполните следующие действия.

1. Отключите общую конфигурацию IIS.
1. Запустите установщик.
1. Экспортируйте обновленный файл `applicationHost.config` в общую папку.
1. Повторно включите общую конфигурацию IIS.

## <a name="data-protection"></a>Защита данных

[Стек защиты данных ASP.NET Core](xref:security/data-protection/introduction) используют несколько [ПО промежуточного слоя](xref:fundamentals/middleware/index) ASP.NET Core, включая ПО, которое применяется для аутентификации. Даже если API-интерфейсы защиты данных не вызываются из пользовательского кода, защиту данных следует настроить для создания постоянного [хранилища криптографических ключей](xref:security/data-protection/implementation/key-management). Это можно сделать с помощью скрипта развертывания или в пользовательском коде. Если защита данных не настроена, ключи хранятся в памяти и удаляются при перезапуске приложения.

Если набор ключей для защиты данных хранится в памяти, при перезапуске приложения происходит следующее.

* Все токены аутентификации, использующие файлы cookie, становятся недействительными. 
* При выполнении следующего запроса пользователю требуется выполнить вход снова. 
* Все данные, защищенные с помощью набора ключей, больше не могут быть расшифрованы. Это могут быть [токены CSRF](xref:security/anti-request-forgery#aspnet-core-antiforgery-configuration) и [файлы cookie временных данных ASP.NET Core MVC](xref:fundamentals/app-state#tempdata).

Чтобы настроить защиту данных в службах IIS для хранения набора ключей, воспользуйтесь **одним** из следующих методов:

* **Создание разделов реестра для защиты данных**

  Ключи защиты данных, используемые приложениями ASP.NET Core, хранятся во внешнем для приложений реестре. Чтобы хранить эти ключи для определенного приложения, нужно создать разделы реестра для пула приложений.

  При автономной установке служб IIS, не поддерживающей веб-ферму, можно выполнить [скрипт PowerShell Provision-AutoGenKeys.ps1 для защиты данных](https://github.com/dotnet/AspNetCore/blob/master/src/DataProtection/Provision-AutoGenKeys.ps1) применительно к каждому пулу приложений, в который входит приложение ASP.NET Core. Этот скрипт создает раздел в реестре HKLM, который будет доступен только для учетной записи рабочего процесса пула приложений, к которому относится соответствующее приложение. Неактивные ключи шифруются с помощью API защиты данных с ключом компьютера.

  В случаях, когда используется веб-ферма, в приложении можно настроить UNC-путь, по которому это приложение будет хранить набор ключей для защиты данных. По умолчанию ключи не шифруются. Разрешения на доступ к файлам в сетевой папке должны быть предоставлены только учетной записи Windows, с помощью которой выполняется приложение. Для защиты неактивных ключей можно использовать сертификат X509. Рассмотрите возможность реализации механизма, позволяющего пользователям отправлять сертификаты. поместите сертификаты в хранилище доверенных сертификатов пользователя и обеспечьте их доступность на всех компьютерах, где выполняется приложение. Дополнительные сведения см. в разделе <xref:security/data-protection/configuration/overview>.

* **Настройка пула приложений IIS для загрузки профиля пользователя**.

  Этот параметр находится на странице **Дополнительные параметры** пула приложений в разделе **Модель процесса**. Задайте для параметра **Загрузить профиль пользователя** значение `True`. Если задать значение `True`, ключи будут храниться в каталоге профиля пользователя и защищаться с помощью API защиты данных и ключа на уровне учетной записи пользователя. Ключи хранятся в папке `%LOCALAPPDATA%/ASP.NET/DataProtection-Keys`.

  Также необходимо включить [атрибут `setProfileEnvironment`](/iis/configuration/system.applicationhost/applicationpools/add/processmodel#configuration) пула приложений. Значением свойства `setProfileEnvironment` по умолчанию является `true`. В некоторых сценариях (например, в ОС Windows) для параметра `setProfileEnvironment` установлено значение `false`. Если ключи не хранятся в каталоге профиля пользователя:

  1. Перейдите в папку `%windir%/system32/inetsrv/config`.
  1. Откройте файл `applicationHost.config` .
  1. Найдите элемент `<system.applicationHost><applicationPools><applicationPoolDefaults><processModel>` .
  1. Убедитесь, что атрибут `setProfileEnvironment` отсутствует и установлено значение по умолчанию `true`, или же явно задайте для атрибута значение `true`.

* **Использование файловой системы в качестве хранилища набора ключей**.

  Измените код приложения так, чтобы [в качестве хранилища набора ключей использовалась файловая система](xref:security/data-protection/configuration/overview). Для защиты набора ключей используйте доверенный сертификат X509. Если сертификат — самозаверяющий, поместите его в доверенное корневое хранилище.

  При использовании служб IIS в веб-ферме:

  * используйте общую папку, которая доступна всем компьютерам;
  * разверните сертификат X509 на каждом компьютере; настройте [защиту данных в коде](xref:security/data-protection/configuration/overview).

* **Настройка политики защиты данных на уровне компьютера**

  Система защиты данных обеспечивает ограниченную поддержку задания [политики по умолчанию на уровне компьютера](xref:security/data-protection/configuration/machine-wide-policy) для всех приложений, использующих интерфейсы API защиты данных. Дополнительные сведения см. в разделе <xref:security/data-protection/introduction>.

## <a name="iis-configuration"></a>Конфигурация IIS

**Операционные системы семейства Windows Server**

Включите роль сервера **Веб-сервер (IIS)** и настройте службы роли.

1. В меню **Управление** запустите мастер **Добавить роли и компоненты** или в окне **Диспетчер серверов** щелкните соответствующую ссылку. На этапе **Роли сервера** установите флажок **Веб-сервер (IIS)** .

   ![Роль "Веб-сервер (IIS)" выбрана на странице "Выбор ролей сервера".](index/_static/server-roles-ws2016.png)

1. После этапа выбора **компонентов** запускается этап выбора **служб роли** для веб-сервера (IIS). Выберите нужные службы роли IIS или оставьте службы по умолчанию.

   ![Службы роли по умолчанию, выбранные на странице "Выбор служб ролей".](index/_static/role-services-ws2016.png)

   **Проверка подлинности Windows (необязательный компонент)**  
   Чтобы включить проверку подлинности Windows, разверните такие узлы: **Веб-сервер** > **Безопасность**. Выберите компонент **Проверка подлинности Windows**. Дополнительные сведения см. в статьях [Проверка подлинности Windows `<windowsAuthentication>`](/iis/configuration/system.webServer/security/authentication/windowsAuthentication/) и [Настройка проверки подлинности Windows](xref:security/authentication/windowsauth).

   **Протокол WebSocket (необязательный компонент)**  
   Протокол WebSocket поддерживается в ASP.NET Core начиная с версии 1.1. Чтобы включить протокол WebSocket, разверните такие узлы: **Веб-сервер** > **Разработка приложений**. Выберите компонент **Протокол WebSocket**. Дополнительные сведения см. в разделе [Протокол WebSocket](xref:fundamentals/websockets).

1. Пройдите этап **Подтверждение**, чтобы установить роль и службы веб-сервера. После установки роли **Веб-сервер (IIS)** перезагружать сервер или службы IIS не требуется.

**Операционные системы Windows для настольных компьютеров**

Включите компоненты **Консоль управления IIS** и **Службы Интернета**.

1. Последовательно выберите **Панель управления** > **Программы** > **Программы и компоненты** > **Включение или отключение компонентов Windows** (в левой части экрана).

1. Разверните узел **Службы IIS**. Разверните узел **Средства управления веб-сайтом**.

1. Установите флажок **Консоль управления IIS**.

1. Установите флажок **Службы Интернета**.

1. В группе **Службы Интернета** оставьте компоненты по умолчанию или настройте компоненты IIS.

   **Проверка подлинности Windows (необязательный компонент)**  
   Чтобы включить проверку подлинности Windows, разверните такие узлы: **Службы Интернета** > **Безопасность**. Выберите компонент **Проверка подлинности Windows**. Дополнительные сведения см. в статьях [Проверка подлинности Windows `<windowsAuthentication>`](/iis/configuration/system.webServer/security/authentication/windowsAuthentication/) и [Настройка проверки подлинности Windows](xref:security/authentication/windowsauth).

   **Протокол WebSocket (необязательный компонент)**  
   Протокол WebSocket поддерживается в ASP.NET Core начиная с версии 1.1. Чтобы включить протокол WebSocket, разверните такие узлы: **Службы Интернета** > **Компоненты разработки приложений**. Выберите компонент **Протокол WebSocket**. Дополнительные сведения см. в разделе [Протокол WebSocket](xref:fundamentals/websockets).

1. Если во время установки IIS потребуется перезагрузка, перезагрузите систему.

![Группы "Консоль управления IIS" и "Службы Интернета" выбраны в окне "Компоненты Windows".](index/_static/windows-features-win10.png)

## <a name="virtual-directories"></a>Виртуальные каталоги

[Виртуальные каталоги IIS](/iis/get-started/planning-your-iis-architecture/understanding-sites-applications-and-virtual-directories-on-iis#virtual-directories) не поддерживаются в приложениях ASP.NET Core. Приложение может размещаться как [вложенное](#sub-applications).

## <a name="sub-applications"></a>Вложенные приложения

Приложение ASP.NET Core можно разместить как [вложенное приложение IIS](/iis/get-started/planning-your-iis-architecture/understanding-sites-applications-and-virtual-directories-on-iis#applications). Путь к вложенному приложению становится частью URL-адреса главного приложения.

В ссылках на статический ресурс во вложенном приложении следует использовать нотацию `~/`. Такая нотация активирует [вспомогательную функцию тега](xref:mvc/views/tag-helpers/intro) для добавления свойства pathbase вложенного приложения в начало отображаемой относительной ссылки. Для вложенного приложения с путем `/subapp_path` ссылка на изображение `src="~/image.png"` отображается как `src="/subapp_path/image.png"`. ПО промежуточного слоя для обработки статических файлов в главном приложении не обрабатывает такой запрос статического файла. Запрос обрабатывается соответствующим ПО вложенного приложения.

Если атрибуту `src` статического ресурса присваивается абсолютный путь (например, `src="/image.png"`), ссылка отображается без свойства pathbase вложенного приложения. ПО промежуточного слоя для обработки статических файлов в главном приложении пытается найти ресурс в [корневом веб-каталоге](xref:fundamentals/index#web-root) главного приложения, что приводит к ошибке *404 — Not Found* (не найдено), кроме случаев, когда статический ресурс доступен из главного приложения.

Для размещения приложения ASP.NET Core в качестве приложения, вложенного в другое приложение ASP.NET Core, сделайте следующее:

1. Создайте пул приложений для вложенного приложения. Установите для параметра **Версия среды CLR .NET** значение **Без управляемого кода**, так как для размещения приложения в рабочем процессе запускается CoreCLR для .NET Core, а не среда CRL для настольных ПК (.NET CLR).

1. Добавьте корневой веб-сайт в диспетчере служб IIS с вложенным приложением в папке внутри корневого веб-сайта.

1. Щелкните правой кнопкой мыши папку вложенного приложения в диспетчере служб IIS и выберите **Преобразовать в приложение**.

1. В диалоговом окне **Добавление приложения** нажмите кнопку **Выбрать**, чтобы назначить созданный **пул приложений** вложенному приложению. Нажмите кнопку **ОК**.

Назначение отдельного пула приложений вложенному приложению является обязательным при использовании модели внутрипроцессного размещения.

Дополнительные сведения о внутрипроцессной модели размещения и настройке модуля ASP.NET Core см. в статье <xref:host-and-deploy/aspnet-core-module>.

## <a name="application-pools"></a>Пулы приложений

Модель размещения определяет изоляцию пула приложений:

* Внутрипроцессное размещение: Приложения должны выполняться в отдельных пулах.
* Размещение вне процесса: Рекомендуем изолировать приложения друг от друга, запуская каждое из них в собственном пуле.

В диалоговом окне **Добавление веб-сайта** IIS на каждое приложение по умолчанию задан один пул приложений. Если указано **Имя сайта**, оно автоматически переносится в текстовое поле **Пул приложений**. При добавлении веб-сайта создается пул приложений с именем сайта.

## <a name="application-pool-no-locidentity"></a>Identity пула приложений

Учетная запись удостоверения пула приложений позволяет запускать приложение от имени уникальной учетной записи, не создавая домены или локальные учетные записи и не управляя ими. В службах IIS начиная с версии 8.0 рабочий процесс администратора IIS (WAS) создает виртуальную учетную запись с именем нового пула приложений и по умолчанию выполняет рабочие процессы пула приложений с помощью этой учетной записи. В консоли управления IIS в окне **Дополнительные параметры** пула приложений для **Identity** необходимо выбрать `ApplicationPoolIdentity`.

![Диалоговое окно дополнительных параметров для пула приложений](index/_static/apppool-identity.png)

Процесс управления IIS создает в системе безопасности Windows безопасный идентификатор с именем пула приложений. С помощью этого идентификатора можно защищать ресурсы, но он не является реальной учетной записью и не отображается в консоли управления пользователями Windows.

Если рабочему процессу IIS требуется предоставить доступ к приложению с повышенными правами, измените список управления доступом (ACL) для каталога, содержащего приложение.

1. Откройте проводник и перейдите к каталогу.

1. Щелкните каталог правой кнопкой мыши и выберите пункт **Свойства**.

1. На вкладке **Безопасность** нажмите кнопку **Изменить**, а затем — кнопку **Добавить**.

1. Нажмите кнопку **Размещение** и выберите систему.

1. В области **Введите имена объектов для выбора** введите значение в формате `IIS AppPool\{APP POOL NAME}`, где заполнитель `{APP POOL NAME}` представляет собой имя пула приложения. Нажмите кнопку **Проверить имена**. В случае с *DefaultAppPool* проверьте имена с помощью `IIS AppPool\DefaultAppPool`. После нажатия кнопки **Проверить имена** в области имен объектов отобразится значение `DefaultAppPool`. Вручную ввести имя пула приложений в области имен объектов нельзя. При проверке имени объекта используйте формат `IIS AppPool\{APP POOL NAME}`, где заполнитель `{APP POOL NAME}` представляет собой имя пула приложения.

   ![Диалоговое окно "Выбор пользователей или групп" для папки приложения. До нажатия кнопки "Проверить имена" в области имен объектов к строке IIS AppPool\" добавилось имя пула приложений, DefaultAppPool.](index/_static/select-users-or-groups-1.png)

1. Нажмите кнопку **ОК**.

   ![Диалоговое окно "Выбор пользователей или групп" для папки приложения. После нажатия кнопки "Проверить имена" в области имен объектов отображается имя пула приложений, DefaultAppPool.](index/_static/select-users-or-groups-2.png)

1. Разрешения на чтение и выполнение предоставляются по умолчанию. При необходимости предоставьте дополнительные разрешения.

Кроме того, доступ можно предоставить через командную строку, используя средство **ICACLS**. В случае с *DefaultAppPool* выполняется такая команда:

```console
ICACLS C:\sites\MyWebApp /grant "IIS AppPool\DefaultAppPool":F
```

Дополнительные сведения об ICACLS см. [здесь](/windows-server/administration/windows-commands/icacls).

## <a name="http2-support"></a>Поддержка HTTP/2

[HTTP/2](https://httpwg.org/specs/rfc7540.html) поддерживается в ASP.NET Core для следующих сценариев развертывания IIS:

* Внутрипроцессно
  * Windows Server 2016 / Windows 10 или более поздних версий; IIS 10 или более поздней версии
  * Подключение TLS 1.2 или более поздней версии.
* Внепроцессно
  * Windows Server 2016 / Windows 10 или более поздних версий; IIS 10 или более поздней версии
  * Подключения к пограничным серверам, открытых для общего доступа, выполняются по протоколу HTTP/2, а подключения к [серверу Kestrel](xref:fundamentals/servers/kestrel) через обратный прокси-сервер — по HTTP/1.1.
  * Подключение TLS 1.2 или более поздней версии.

При внутрипроцессном развертывании и установленном подключении HTTP/2 [`HttpRequest.Protocol`](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) возвращает `HTTP/2`. При внепроцессном развертывании и установленном подключении HTTP/2 [`HttpRequest.Protocol`](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) возвращает `HTTP/1.1`.

Дополнительные сведения о внутрипроцессной и внепроцессной моделях размещения см. в статье <xref:host-and-deploy/aspnet-core-module>.

Протокол HTTP/2 включен по умолчанию. Если не удается установить подключение HTTP/2, применяется резервный вариант HTTP/1.1. Дополнительные сведения о настройке HTTP/2 для развертываний IIS см. в статье [об HTTP/2 в IIS](/iis/get-started/whats-new-in-iis-10/http2-on-iis).

## <a name="cors-preflight-requests"></a>Предварительные запросы CORS

*Этот раздел относится только к приложениям ASP.NET Core, предназначенным для .NET Framework.*

Для приложения ASP.NET Core, предназначенного для .NET Framework, параметры OPTIONS не передаются в приложение по умолчанию в службах IIS. Чтобы узнать, как настроить обработчики приложения IIS в файле `web.config` для передачи запросов OPTIONS, см. раздел [Enable cross-origin requests in ASP.NET Web API 2. How CORS Works](/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api#how-cors-works) (Включение запросов CORS в ASP.NET Web API 2. Принцип работы CORS).

## <a name="application-initialization-module-and-idle-timeout"></a>Модуль инициализации приложений и время ожидания в режиме простоя

Размещение в IIS с помощью модуля ASP.NET Core версии 2:

* [Модуль инициализации приложений](#application-initialization-module). Приложение, размещенное [в процессе](xref:host-and-deploy/iis/in-process-hosting) или [вне процесса](xref:host-and-deploy/iis/out-of-process-hosting), можно настроить на автоматический запуск при перезапуске рабочего процесса или сервера.
* [Время ожидания в режиме простоя](#idle-timeout). Приложение, размещенное [в процессе](xref:host-and-deploy/iis/in-process-hosting), можно настроить на игнорирование времени ожидания в периоды неактивности.

### <a name="application-initialization-module"></a>Модуль инициализации приложений

*Применяется к приложениям, размещенным в процессе и вне процесса.*

Функция [инициализации приложений](/iis/get-started/whats-new-in-iis-8/iis-80-application-initialization) в IIS отправляет в приложение HTTP-запрос при запуске или перезапуске пула приложений. Этот запрос инициирует запуск приложения. По умолчанию IIS отправляет запрос к корневому URL-адресу приложения (`/`) для его инициализации (подробные сведения о конфигурации см. в [дополнительных ресурсах](#application-initialization-module-and-idle-timeout-additional-resources)).

Убедитесь, что включена роль инициализации приложения IIS.

На настольных компьютерах с Windows 7 или более поздней версии при локальном использовании IIS:

1. Последовательно выберите **Панель управления** > **Программы** > **Программы и компоненты** > **Включение или отключение компонентов Windows** (в левой части экрана).
1. Откройте **Службы IIS** > **Службы Интернета** > **Компоненты разработки приложений**.
1. Установите флажок **Инициализация приложений**.

В Windows Server 2008 R2 и более поздней версии:

1. Откройте **Мастер добавления ролей и компонентов**.
1. На панели **Выбор служб ролей** разверните узел **Разработка приложений**.
1. Установите флажок **Инициализация приложений**.

Чтобы включить модуль инициализации приложений для сайта, используйте один из следующих подходов.

* При использовании диспетчера IIS:

  1. Выберите **Пулы приложений** на панели **Подключения**.
  1. Щелкните пул приложений в списке правой кнопкой мыши и выберите **Дополнительные параметры**.
  1. Для **режима запуска** по умолчанию задано значение `OnDemand`. Выберите для параметра **Режим запуска** значение `AlwaysRunning`. Нажмите кнопку **ОК**.
  1. Откройте узел **Сайты** на панели **Подключения**.
  1. Щелкните приложение правой кнопкой мыши и выберите **Управление веб-сайтом** > **Дополнительные параметры**.
  1. По умолчанию для параметра **Предварительная загрузка включена** установлено значение `False`. Для параметра **Предварительная загрузка включена** выберите значение `True`. Щелкните **ОК**.

* Откройте `web.config` и добавьте элемент `<applicationInitialization>` с параметром `doAppInitAfterRestart`, для которого установлено значение `true`, к элементам `<system.webServer>` в файле `web.config` приложения.

  ```xml
  <?xml version="1.0" encoding="utf-8"?>
  <configuration>
    <location path="." inheritInChildApplications="false">
      <system.webServer>
        <applicationInitialization doAppInitAfterRestart="true" />
      </system.webServer>
    </location>
  </configuration>
  ```

### <a name="idle-timeout"></a>Время ожидания в режиме простоя

*Применяется только к приложениям, размещенным в процессе.*

Чтобы предотвратить переход приложения из состояния простоя, задайте для пула приложений время ожидания в режиме простоя с помощью диспетчера IIS:

1. Выберите **Пулы приложений** на панели **Подключения**.
1. Щелкните пул приложений в списке правой кнопкой мыши и выберите **Дополнительные параметры**.
1. По умолчанию для параметра **Тайм-аут простоя (в минутах)** установлено значение `20` минут. Задайте для параметра **Тайм-аут простоя (в минутах)** значение `0`. Нажмите кнопку **ОК**.
1. Перезапустите рабочий процесс.

Чтобы не истекло время ожидания в приложениях, размещенных [вне процесса](xref:host-and-deploy/iis/out-of-process-hosting), воспользуйтесь одним из таких методов:

* Проверьте связь с приложением из внешней службы, чтобы оно продолжило работу.
* Если приложение размещает только фоновые службы, избегайте размещения в службах IIS и воспользуйтесь [службой Windows для размещения приложения ASP.NET Core](xref:host-and-deploy/windows-service).

### <a name="application-initialization-module-and-idle-timeout-additional-resources"></a>Дополнительные ресурсы по модулю инициализации приложений и времени ожидания в режиме простоя

* [Инициализация приложений в IIS 8.0](/iis/get-started/whats-new-in-iis-8/iis-80-application-initialization)
* [Инициализация приложений `<applicationInitialization>`](/iis/configuration/system.webserver/applicationinitialization/).
* [Параметры модели процессов для пула приложений `<processModel>`](/iis/configuration/system.applicationhost/applicationpools/add/processmodel).

## <a name="module-schema-and-configuration-file-locations"></a>Модуль, схемы и расположение файлов конфигурации

### <a name="module"></a>Module

**IIS (x86/amd64)** :

* `%windir%\System32\inetsrv\aspnetcore.dll`

* `%windir%\SysWOW64\inetsrv\aspnetcore.dll`

* `%ProgramFiles%\IIS\Asp.Net Core Module\V2\aspnetcorev2.dll`

* `%ProgramFiles(x86)%\IIS\Asp.Net Core Module\V2\aspnetcorev2.dll`

**IIS Express (x86/amd64)** :

* `%ProgramFiles%\IIS Express\aspnetcore.dll`

* `%ProgramFiles(x86)%\IIS Express\aspnetcore.dll`

* `%ProgramFiles%\IIS Express\Asp.Net Core Module\V2\aspnetcorev2.dll`

* `%ProgramFiles(x86)%\IIS Express\Asp.Net Core Module\V2\aspnetcorev2.dll`

### <a name="schema"></a>Схема

**Службы IIS**

* `%windir%\System32\inetsrv\config\schema\aspnetcore_schema.xml`

* `%windir%\System32\inetsrv\config\schema\aspnetcore_schema_v2.xml`

**IIS Express**

* `%ProgramFiles%\IIS Express\config\schema\aspnetcore_schema.xml`

* `%ProgramFiles%\IIS Express\config\schema\aspnetcore_schema_v2.xml`

### <a name="configuration"></a>Параметр Configuration

**Службы IIS**

* `%windir%\System32\inetsrv\config\applicationHost.config`

**IIS Express**

* Visual Studio: `{APPLICATION ROOT}\.vs\config\applicationHost.config`

* CLI *iisexpress.exe*: `%USERPROFILE%\Documents\IISExpress\config\applicationhost.config`

Файлы можно найти путем поиска `aspnetcore` в файле `applicationHost.config`.
